<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë²½ëŒê¹¨ê¸° ê²Œì„</title>
  <style>
    /* í˜ì´ì§€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #222 0, #111 40%, #000 100%);
      color: #f5f5f5;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    h1 {
      margin-bottom: 10px;
      font-size: 24px;
      letter-spacing: 2px;
    }

    .info {
      margin-bottom: 10px;
      font-size: 14px;
      opacity: 0.9;
      text-align: center;
      line-height: 1.4;
    }

    /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
    .game-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
    }

    canvas {
      display: block;
      background: linear-gradient(180deg, #050816 0%, #02030a 100%);
    }

    /* í™”ë©´ í‘œì‹œìš© HUD */
    .hud {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 30px;
      font-size: 14px;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
    }

    .hud span.label {
      opacity: 0.7;
      margin-right: 4px;
    }

    /* ê°€ìš´ë° ì•ˆë‚´ í…ìŠ¤íŠ¸ */
    .center-text {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      font-size: 18px;
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.9);
    }

    /* ëª¨ë°”ì¼ì—ì„œ ì¡°ê¸ˆ ì‘ê²Œ */
    @media (max-width: 900px) {
      canvas {
        width: 90vw;
        height: calc(90vw * 0.75);
      }
    }
  </style>
</head>
<body>
  <h1>ë²½ëŒê¹¨ê¸° ê²Œì„</h1>
  <p class="info">
    â¬… / â¡ ë°©í–¥í‚¤ ë˜ëŠ” ë§ˆìš°ìŠ¤ë¡œ íŒ¨ë“¤ì„ ì›€ì§ì´ì„¸ìš”.<br />
    <strong>Space</strong> ë˜ëŠ” í´ë¦­ìœ¼ë¡œ ê²Œì„ ì‹œì‘ / ì¬ì‹œì‘
  </p>

  <div class="game-wrapper">
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div class="hud">
      <div><span class="label">ì ìˆ˜</span><span id="scoreText">0</span></div>
      <div><span class="label">ìŠ¤í…Œì´ì§€</span><span id="levelText">1</span></div>
      <div><span class="label">ëª©ìˆ¨</span><span id="livesText">3</span></div>
    </div>

    <div class="center-text" id="centerText">
      Space ë˜ëŠ” í´ë¦­í•´ì„œ ì‹œì‘!
    </div>
  </div>

  <script>
    // =======================
    // ê¸°ë³¸ ìº”ë²„ìŠ¤ / ì»¨í…ìŠ¤íŠ¸
    // =======================
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // HUD ìš”ì†Œ
    const scoreText = document.getElementById("scoreText");
    const livesText = document.getElementById("livesText");
    const levelText = document.getElementById("levelText");
    const centerText = document.getElementById("centerText");

    // =======================
    // ê²Œì„ ì„¤ì • ê°’
    // =======================
    const PADDLE_HEIGHT = 14;
    const PADDLE_WIDTH = 110;
    const PADDLE_MARGIN_BOTTOM = 40;

    const BALL_RADIUS = 8;

    // ë²½ëŒ ì„¤ì •
    const BRICK_ROW_COUNT_START = 4;
    const BRICK_COLUMN_COUNT = 10;
    const BRICK_WIDTH = 64;
    const BRICK_HEIGHT = 20;
    const BRICK_PADDING = 8;
    const BRICK_OFFSET_TOP = 70;
    const BRICK_OFFSET_LEFT = (canvas.width - (BRICK_COLUMN_COUNT * (BRICK_WIDTH + BRICK_PADDING) - BRICK_PADDING)) / 2;

    const MAX_LEVEL = 10;
    const INITIAL_LIVES = 3;

    // =======================
    // ê²Œì„ ìƒíƒœ
    // =======================
    let paddleX;
    let rightPressed = false;
    let leftPressed = false;

    let ballX;
    let ballY;
    let ballDX;
    let ballDY;

    let bricks = [];
    let score = 0;
    let lives = INITIAL_LIVES;
    let level = 1;

    let isRunning = false;   // ì• ë‹ˆë©”ì´ì…˜ ì§„í–‰ ì—¬ë¶€
    let ballStuck = true;    // ê³µì´ íŒ¨ë“¤ì— ë¶™ì–´ìˆëŠ” ìƒíƒœ (ì‹œì‘ ì „)

    // =======================
    // ì´ˆê¸°í™” í•¨ìˆ˜ë“¤
    // =======================
    function initPaddle() {
      paddleX = (canvas.width - PADDLE_WIDTH) / 2;
    }

    function initBall() {
      // íŒ¨ë“¤ ì¤‘ì•™ ìœ„ì— ê³µ ë°°ì¹˜
      ballX = paddleX + PADDLE_WIDTH / 2;
      ballY = canvas.height - PADDLE_MARGIN_BOTTOM - PADDLE_HEIGHT - BALL_RADIUS;

      // ë ˆë²¨ì— ë”°ë¼ ì†ë„ ì¡°ê¸ˆì”© ì¦ê°€
      const baseSpeed = 4;
      const speed = baseSpeed + (level - 1) * 0.4;
      const angle = (Math.random() * 0.6 + 0.2) * Math.PI; // ìœ„ìª½ ë°©í–¥ (ëœë¤)

      ballDX = speed * Math.cos(angle);
      ballDY = -Math.abs(speed * Math.sin(angle)); // ìœ„ë¡œ
    }

    function initBricks() {
      const rowCount = BRICK_ROW_COUNT_START + (level - 1); // ë ˆë²¨ ì˜¬ë¼ê°ˆìˆ˜ë¡ í•œ ì¤„ì”© ì¦ê°€
      bricks = [];
      for (let c = 0; c < BRICK_COLUMN_COUNT; c++) {
        bricks[c] = [];
        for (let r = 0; r < rowCount; r++) {
          const brickX = BRICK_OFFSET_LEFT + c * (BRICK_WIDTH + BRICK_PADDING);
          const brickY = BRICK_OFFSET_TOP + r * (BRICK_HEIGHT + BRICK_PADDING);
          bricks[c][r] = {
            x: brickX,
            y: brickY,
            status: 1    // 1 = ì‚´ì•„ìˆìŒ, 0 = ê¹¨ì§
          };
        }
      }
    }

    function resetLevel() {
      initPaddle();
      initBall();
      initBricks();
      ballStuck = true;
      isRunning = true;
      updateHUD();
      centerText.textContent = "Space ë˜ëŠ” í´ë¦­í•´ì„œ ì‹œì‘!";
      centerText.style.opacity = "1";
    }

    function resetGame() {
      score = 0;
      lives = INITIAL_LIVES;
      level = 1;
      resetLevel();
    }

    // =======================
    // ê·¸ë¦¬ê¸° í•¨ìˆ˜ë“¤
    // =======================
    function drawPaddle() {
      const gradient = ctx.createLinearGradient(paddleX, 0, paddleX + PADDLE_WIDTH, 0);
      gradient.addColorStop(0, "#00b4d8");
      gradient.addColorStop(1, "#48cae4");

      ctx.fillStyle = gradient;
      ctx.fillRect(
        paddleX,
        canvas.height - PADDLE_MARGIN_BOTTOM - PADDLE_HEIGHT,
        PADDLE_WIDTH,
        PADDLE_HEIGHT
      );
      // ìœ„ìª½ ë¼ì¸
      ctx.strokeStyle = "rgba(255,255,255,0.5)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(paddleX, canvas.height - PADDLE_MARGIN_BOTTOM - PADDLE_HEIGHT);
      ctx.lineTo(paddleX + PADDLE_WIDTH, canvas.height - PADDLE_MARGIN_BOTTOM - PADDLE_HEIGHT);
      ctx.stroke();
    }

    function drawBall() {
      const gradient = ctx.createRadialGradient(ballX, ballY, 2, ballX, ballY, BALL_RADIUS);
      gradient.addColorStop(0, "#ffffff");
      gradient.addColorStop(1, "#f72585");

      ctx.beginPath();
      ctx.arc(ballX, ballY, BALL_RADIUS, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();
      ctx.closePath();
    }

    function drawBricks() {
      for (let c = 0; c < bricks.length; c++) {
        for (let r = 0; r < bricks[c].length; r++) {
          const b = bricks[c][r];
          if (b.status === 1) {
            // ìƒ‰ìƒì€ í–‰/ì—´ì— ë”°ë¼ ë³€í™”
            const hue = 200 + r * 15;
            const saturation = 70;
            const lightness = 45 + c * 2;
            ctx.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
            ctx.fillRect(b.x, b.y, BRICK_WIDTH, BRICK_HEIGHT);

            // ìœ¤ê³½ì„ 
            ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
            ctx.strokeRect(b.x, b.y, BRICK_WIDTH, BRICK_HEIGHT);
          }
        }
      }
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // =======================
    // ì¶©ëŒ ì²˜ë¦¬
    // =======================
    function collisionDetection() {
      let bricksLeft = 0;

      for (let c = 0; c < bricks.length; c++) {
        for (let r = 0; r < bricks[c].length; r++) {
          const b = bricks[c][r];
          if (b.status === 1) {
            bricksLeft++;
            if (
              ballX > b.x &&
              ballX < b.x + BRICK_WIDTH &&
              ballY > b.y &&
              ballY < b.y + BRICK_HEIGHT
            ) {
              ballDY = -ballDY;
              b.status = 0;
              score += 10;
              updateHUD();
              bricksLeft--;
            }
          }
        }
      }

      // ëª¨ë“  ë²½ëŒì„ ê¹¨ë©´ ë‹¤ìŒ ë ˆë²¨
      if (bricksLeft === 0) {
        if (level >= MAX_LEVEL) {
          gameClear();
        } else {
          level++;
          nextLevel();
        }
      }
    }

    function handleWallCollision() {
      // ì¢Œìš° ë²½
      if (ballX + ballDX > canvas.width - BALL_RADIUS || ballX + ballDX < BALL_RADIUS) {
        ballDX = -ballDX;
      }

      // ìœ„ìª½ ë²½
      if (ballY + ballDY < BALL_RADIUS) {
        ballDY = -ballDY;
      }

      // ì•„ë˜ìª½(ë°”ë‹¥) - ëª©ìˆ¨ ê°ì†Œ
      if (ballY + ballDY > canvas.height - BALL_RADIUS) {
        loseLife();
      }
    }

    function handlePaddleCollision() {
      const paddleTop = canvas.height - PADDLE_MARGIN_BOTTOM - PADDLE_HEIGHT;
      const paddleBottom = canvas.height - PADDLE_MARGIN_BOTTOM;
      const paddleRight = paddleX + PADDLE_WIDTH;
      const paddleLeft = paddleX;

      if (
        ballY + BALL_RADIUS >= paddleTop &&
        ballY + BALL_RADIUS <= paddleBottom &&
        ballX >= paddleLeft &&
        ballX <= paddleRight &&
        ballDY > 0 // ì•„ë˜ë¡œ ë‚´ë ¤ì˜¬ ë•Œë§Œ
      ) {
        // íŒ¨ë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ ê³µì´ ë§ì€ ìœ„ì¹˜ì— ë”°ë¼ ê°ë„ë¥¼ ì¡°ì ˆ
        const hitPos = (ballX - (paddleX + PADDLE_WIDTH / 2)) / (PADDLE_WIDTH / 2); // -1 ~ 1
        const maxBounceAngle = (75 * Math.PI) / 180; // 75ë„
        const bounceAngle = hitPos * maxBounceAngle;

        const speed = Math.sqrt(ballDX * ballDX + ballDY * ballDY);

        ballDX = speed * Math.sin(bounceAngle);
        ballDY = -Math.abs(speed * Math.cos(bounceAngle)); // ìœ„ ë°©í–¥
      }
    }

    // =======================
    // ê²Œì„ ì§„í–‰ ë¡œì§
    // =======================
    function updateHUD() {
      scoreText.textContent = score;
      livesText.textContent = lives;
      levelText.textContent = level;
    }

    function loseLife() {
      lives--;
      updateHUD();

      if (lives <= 0) {
        gameOver();
      } else {
        // ê³µ/íŒ¨ë“¤ ìœ„ì¹˜ë§Œ ë‹¤ì‹œ
        ballStuck = true;
        initPaddle();
        initBall();
        centerText.textContent = "ë‚¨ì€ ëª©ìˆ¨: " + lives + "  |  Space ë˜ëŠ” í´ë¦­í•´ì„œ ê³„ì†!";
        centerText.style.opacity = "1";
      }
    }

    function nextLevel() {
      centerText.textContent = "ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ! (ë ˆë²¨ " + level + ")";
      centerText.style.opacity = "1";
      resetLevel();
    }

    function gameOver() {
      isRunning = false;
      centerText.innerHTML = "ê²Œì„ ì˜¤ë²„!<br>Space ë˜ëŠ” í´ë¦­í•´ì„œ ë‹¤ì‹œ ì‹œì‘";
      centerText.style.opacity = "1";
    }

    function gameClear() {
      isRunning = false;
      centerText.innerHTML = "ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ğŸ‰<br>Space ë˜ëŠ” í´ë¦­í•´ì„œ ë‹¤ì‹œ ì‹œì‘";
      centerText.style.opacity = "1";
    }

    // ë©”ì¸ ë£¨í”„
    function draw() {
      if (!isRunning) {
        // ê²Œì„ì˜¤ë²„/í´ë¦¬ì–´ ìƒíƒœì—ì„œë„ í™”ë©´ì€ ë§ˆì§€ë§‰ ìƒíƒœ ìœ ì§€
        requestAnimationFrame(draw);
        return;
      }

      clearCanvas();
      drawBricks();
      drawPaddle();
      drawBall();

      // ê³µì´ íŒ¨ë“¤ì— ë¶™ì–´ ìˆëŠ” ìƒíƒœë©´, íŒ¨ë“¤ê³¼ ê°™ì´ ì›€ì§ì´ê¸°ë§Œ í•¨
      if (!ballStuck) {
        collisionDetection();
        handleWallCollision();
        handlePaddleCollision();

        ballX += ballDX;
        ballY += ballDY;
      } else {
        // íŒ¨ë“¤ê³¼ ê°™ì´ ì›€ì§ì´ë„ë¡
        ballX = paddleX + PADDLE_WIDTH / 2;
        ballY = canvas.height - PADDLE_MARGIN_BOTTOM - PADDLE_HEIGHT - BALL_RADIUS;
      }

      // íŒ¨ë“¤ ì´ë™
      if (rightPressed) {
        paddleX += 6;
        if (paddleX + PADDLE_WIDTH > canvas.width) {
          paddleX = canvas.width - PADDLE_WIDTH;
        }
      } else if (leftPressed) {
        paddleX -= 6;
        if (paddleX < 0) {
          paddleX = 0;
        }
      }

      requestAnimationFrame(draw);
    }

    // =======================
    // ì…ë ¥ ì²˜ë¦¬
    // =======================
    document.addEventListener("keydown", function (e) {
      if (e.code === "ArrowRight") {
        rightPressed = true;
      } else if (e.code === "ArrowLeft") {
        leftPressed = true;
      } else if (e.code === "Space") {
        startOrResumeGame();
      }
    });

    document.addEventListener("keyup", function (e) {
      if (e.code === "ArrowRight") {
        rightPressed = false;
      } else if (e.code === "ArrowLeft") {
        leftPressed = false;
      }
    });

    // ë§ˆìš°ìŠ¤ ì›€ì§ì„ìœ¼ë¡œ íŒ¨ë“¤ ì œì–´
    document.addEventListener("mousemove", function (e) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const scaleX = canvas.width / rect.width; // CSS í¬ê¸°ì™€ ìº”ë²„ìŠ¤ í¬ê¸° ë¹„êµ
      const canvasX = mouseX * scaleX;

      paddleX = canvasX - PADDLE_WIDTH / 2;
      if (paddleX < 0) paddleX = 0;
      if (paddleX + PADDLE_WIDTH > canvas.width) {
        paddleX = canvas.width - PADDLE_WIDTH;
      }
    });

    // í´ë¦­ìœ¼ë¡œë„ ì‹œì‘/ì¬ì‹œì‘
    canvas.addEventListener("click", startOrResumeGame);
    centerText.addEventListener("click", startOrResumeGame);

    function startOrResumeGame() {
      // ê²Œì„ì˜¤ë²„/í´ë¦¬ì–´ ìƒíƒœì—ì„œ ë‹¤ì‹œ ì‹œì‘
      if (!isRunning && lives <= 0) {
        resetGame();
      } else if (!isRunning && level > MAX_LEVEL) {
        resetGame();
      }

      // ê³µì´ íŒ¨ë“¤ì— ë¶™ì–´ ìˆëŠ” ìƒíƒœë©´ ë°œì‚¬
      if (ballStuck) {
        ballStuck = false;
        centerText.style.opacity = "0";
      }

      isRunning = true;
    }

    // =======================
    // ê²Œì„ ì‹œì‘
    // =======================
    (function init() {
      initPaddle();
      initBall();
      initBricks();
      updateHUD();
      isRunning = true;
      ballStuck = true;
      requestAnimationFrame(draw);
    })();
  </script>
</body>
</html>
